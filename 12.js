import{p as Ae,g as ke,e as Le,f as Ve,h as be,o as Se,k as fe,u as ge,b as g,c as ye,t as Be}from"./DIDzDSBz.js";import{a,b as we,x as ve,p as $e,c as d,g as e,q as de,h as he,u as s,G as L,C as u,M as ie,I as h,H as _,i as ue,F as me,d as pe,l as se,t as k,j as F,J as Ce,o as r,n as Ue}from"./DoqiT5Lj.js";const xe=Ae("/svg/trash.svg"),ze={class:"container"},Te={"aria-label":"breadcrumb"},Ie={class:"breadcrumb onmalika-breadcrumb"},Pe={class:"breadcrumb-item"},Oe=e("li",{class:"breadcrumb-item active","aria-current":"page"},"Оформление заказа",-1),De={key:0,class:"container"},Ne={key:0},He={key:0},qe={class:"row justify-content-between"},Ee={class:"col-lg-6 mb-3"},Re=e("h1",null," Оформление заказа ",-1),Ze={class:"onmalika-checkout-select mb-50"},Fe={class:"onmalika-checkout-select-item"},Ge=e("label",{for:"checkDelivery",class:"label-delivery"},"Доставка",-1),Je={class:"onmalika-checkout-select-item"},Qe=e("label",{for:"checkByself",class:"label-delivery"},"Самовывоз",-1),We={class:"gray-cover"},Ye=e("h5",{class:"mb-3"},"Ваши данные",-1),Ke={class:"d-flex mobile-inputs column-gap-3"},Xe={class:"form-floating w-100"},et=e("label",{for:"deliverynameInput"},"ФИО",-1),tt={class:"form-floating w-100"},ot=e("label",{for:"deliverynumberInput"},"Номер",-1),st={key:0,class:"gray-cover"},at=e("h5",{class:"mb-3"},"Ваши адреса",-1),lt={key:0,class:"alert alert-danger",role:"alert"},nt={class:"onmalika-address"},it={class:"form-check p-0 m-0"},dt=["onClick","checked","id"],rt=["for"],ct={class:"onmalika-address-btns"},ut=["onClick"],ht=e("img",{src:xe,alt:""},null,-1),mt=[ht],pt=["onClick"],_t=F('<path d="M15.832 18.3334V9.16669" stroke="black" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path><path d="M15.832 5.83335V1.66669" stroke="black" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path><path d="M10 18.3334V14.1667" stroke="black" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path><path d="M10 10.8334V1.66669" stroke="black" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path><path d="M4.16797 18.3334V9.16669" stroke="black" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path><path d="M4.16797 5.83335V1.66669" stroke="black" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path><path d="M2.5 9.16669H5.83333" stroke="black" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path><path d="M14.168 9.16669H17.5013" stroke="black" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path><path d="M8.33203 10.8333H11.6654" stroke="black" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path>',9),vt=[_t],kt=F('<div class="form-check p-0 m-0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.9989 13.43C13.722 13.43 15.1189 12.0331 15.1189 10.31C15.1189 8.58687 13.722 7.19 11.9989 7.19C10.2758 7.19 8.87891 8.58687 8.87891 10.31C8.87891 12.0331 10.2758 13.43 11.9989 13.43Z" stroke="black" stroke-width="1.5"></path><path d="M3.62166 8.49C5.59166 -0.169998 18.4217 -0.159997 20.3817 8.5C21.5317 13.58 18.3717 17.88 15.6017 20.54C13.5917 22.48 10.4117 22.48 8.39166 20.54C5.63166 17.88 2.47166 13.57 3.62166 8.49Z" stroke="black" stroke-width="1.5"></path></svg> Добавить новый адрес </div><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 8H14" stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M8 14V2" stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>',2),bt=[kt],ft={key:1,class:"gray-cover"},gt=F('<h5 class="mb-3">Пункт выдачи</h5><div class="onmalika-take-address d-flex align-items-center column-gap-2"><svg height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.25 22.5C17.2165 22.5 18 21.7165 18 20.75C18 19.7835 17.2165 19 16.25 19C15.2835 19 14.5 19.7835 14.5 20.75C14.5 21.7165 15.2835 22.5 16.25 22.5Z" fill="black"></path><path d="M8.25 22.5C9.2165 22.5 10 21.7165 10 20.75C10 19.7835 9.2165 19 8.25 19C7.2835 19 6.5 19.7835 6.5 20.75C6.5 21.7165 7.2835 22.5 8.25 22.5Z" fill="black"></path><path d="M4.84 3.94L4.64 6.39C4.6 6.86 4.97 7.25 5.44 7.25H20.75C21.17 7.25 21.52 6.93 21.55 6.51C21.68 4.74 20.33 3.3 18.56 3.3H6.27C6.17 2.86 5.97 2.44 5.66 2.09C5.16 1.56 4.46 1.25 3.74 1.25H2C1.59 1.25 1.25 1.59 1.25 2C1.25 2.41 1.59 2.75 2 2.75H3.74C4.05 2.75 4.34 2.88 4.55 3.1C4.76 3.33 4.86 3.63 4.84 3.94Z" fill="black"></path><path d="M20.5101 8.75H5.17005C4.75005 8.75 4.41005 9.07 4.37005 9.48L4.01005 13.83C3.87005 15.54 5.21005 17 6.92005 17H18.0401C19.5401 17 20.8601 15.77 20.9701 14.27L21.3001 9.6C21.3401 9.14 20.9801 8.75 20.5101 8.75Z" fill="black"></path></svg><p><span>Товары можно будет забрать в магазине</span> По адресу: DeLonghi, Шайхантахурский район, Малая кольцевая дорога, 59 </p></div>',2),yt=[gt],wt={class:"gray-cover"},$t=e("h5",{class:"mb-3"},"Выберите способ оплаты",-1),Ct={class:"d-flex column-gap-5"},xt={class:"form-check p-0 m-0"},Mt=e("label",{class:"form-check-label",for:"deliverypayment1"}," Картой ",-1),jt={class:"form-check p-0 m-0"},At=e("label",{class:"form-check-label",for:"deliverypayment3"}," Наличные ",-1),Lt={class:"gray-cover"},Vt=e("h5",{class:"mb-3"},"Дополнительная информация к заказу",-1),St={class:"col-lg-5"},Bt=e("h2",null,"Ваш заказ",-1),Ut={class:"onmalika-cart-list"},zt=["onClick"],Tt=e("svg",{width:"14",height:"14",viewBox:"0 0 14 14",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M2.3335 11.6667L11.6668 2.33333",stroke:"black","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M11.6668 11.6667L2.3335 2.33333",stroke:"black","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1),It=[Tt],Pt=["src"],Ot={key:1,src:"http://placehold.co/250x250",class:"card-img-top",alt:"..."},Dt={class:"card-body"},Nt={class:"onmalika-card-cart-title"},Ht={class:"onmalika-card-cart-block"},qt={key:0,class:"onmalika-card-cart-price"},Et={class:"product-counter"},Rt=["onClick"],Zt=["onClick"],Ft={class:"onmalika-price-total"},Gt={class:"d-flex justify-content-between"},Jt=e("p",null,"Общая сумма:",-1),Qt=["disabled"],Wt={key:1},Yt=e("h3",{class:"text-center"},"Ваша корзина пуста",-1),Kt=[Yt],Xt={key:1},eo=e("h1",{class:"text-center"},"Вы не авторизованы",-1),to=[eo],oo={key:1,class:"container"},so=e("h1",{class:"text-center"},"Подгружаем",-1),ao=[so],lo={key:0,class:"modal fade onmalika-address-modal",id:"addressModal",tabindex:"-1","aria-labelledby":"addressModalLabel","aria-hidden":"true"},no={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},io={class:"modal-content"},ro=F('<div class="modal-header"><h4> Адрес доставки</h4><button type="button" class="dark-cover" data-bs-dismiss="modal" aria-label="Close"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.33301 12.6667L12.6663 3.33333" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M12.6663 12.6667L3.33301 3.33333" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div>',1),co={class:"modal-body"},uo={class:"gray-cover"},ho={class:"row"},mo={class:"col-12 mb-3"},po={class:"form-floating w-100"},_o=e("label",{for:"floatingInput"},"Адрес",-1),vo={class:"col-md-4 col-sm-6 mb-3"},ko={class:"form-floating w-100"},bo=e("label",{for:"floatingInput"},"Подъезд",-1),fo={class:"col-md-4 col-sm-6 mb-3"},go={class:"form-floating w-100"},yo=e("label",{for:"floatingInput"},"Этаж",-1),wo={class:"col-md-4 col-sm-6 mb-3"},$o={class:"form-floating w-100"},Co=e("label",{for:"floatingInput"},"Квартира",-1),xo={class:"col-md-4 col-sm-6 mb-3"},Mo={class:"form-floating w-100"},jo=e("label",{for:"floatingInput"},"Ориентир",-1),Ao={class:"col-md-4 col-sm-6"},Lo={class:"form-floating w-100"},Vo=e("label",{for:"floatingInput"},"Название",-1),So={class:"col-md-4 col-sm-6"},Bo=e("button",{type:"submit",class:"dark-cover justify-content-center w-100","data-bs-dismiss":"modal"}," Изменить ",-1),Uo=[Bo],zo=e("button",{type:"submit",class:"dark-cover justify-content-center w-100","data-bs-dismiss":"modal"}," Добавить адресс",-1),To=[zo],Io={class:"modal-footer"},Po=e("button",{type:"submit",class:"dark-cover justify-content-center w-100","data-bs-dismiss":"modal"}," Изменить",-1),Oo=[Po],Do=["disabled"],No={key:1,class:"modal fade onmalika-delete-modal",id:"deleteAddressModal",tabindex:"-1","aria-labelledby":"deleteAddressModalLabel","aria-hidden":"true"},Ho={class:"modal-dialog modal-dialog-centered"},qo={class:"modal-content"},Eo=e("button",{type:"button",class:"clsoe dark-cover","data-bs-dismiss":"modal","aria-label":"Close"},[e("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M3.33301 12.6667L12.6663 3.33333",stroke:"white","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M12.6663 12.6667L3.33301 3.33333",stroke:"white","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})])],-1),Ro={class:"modal-body"},Zo=e("h4",null,"Удалить адрес?",-1),Fo=e("button",{type:"submit",class:"dark-cover","data-bs-dismiss":"modal"},"Да",-1),Go=e("button",{type:"button",class:"light-cover","data-bs-dismiss":"modal"},"Нет",-1),Jo=[Fo,Go],Qo={__name:"checkout",async setup(Me){let D,K;const Z=ke(),X=Le(),b=Ve(),v=be("token_access"),w=a([]),{data:re}=([D,K]=we(()=>g("/user/address/",{cache:!1,headers:{Authorization:`Bearer ${v.value}`}})),D=await D,K(),D);w.value=re.value;const S=a(),G=l=>{S.value=l},y=a("delivery"),J=a(""),Q=a(""),m=a(""),M=a(""),B=a(!1),U=a(!1),N=async()=>{const l=b.items.map(o=>({product_id:o.product.id,quantity:o.quantity}));if(Z.isAuthenticated)if(w&&w.value&&w.value.length>0&&!S.value&&(S.value=w.value[0].id),y.value==="delivery"&&!S.value)B.value=!0;else try{U.value=!0;const o=await g("/user/orders/",{method:"POST",headers:{Authorization:`Bearer ${v.value}`},body:{user:Z.user.id,items:l,user_name:J.value,user_phone:Q.value,delivery_type:y.value,payment_type:m.value,comment:M,delivery_address:S.value}}),p=localStorage.clear("cart");await X.push("/success"),location.reload()}catch{}else await X.push({path:"/user/login",query:{redirect:"checkout"}})},$=Se(),j=l=>{const o=$.currencies.find(x=>x.code===$.selectedCurrency);if(!o)return"Цена не доступна";const p=parseFloat(o.exchange_rate);return`${(l*p).toFixed(0)} `};ve(()=>b.items.length);const ae=ve(()=>{let l=0,o=0;for(const p of b.items)p.product.sale_price?(o=j(p.product.sale_price),l+=p.quantity*o):(o=j(p.product.price),l+=p.quantity*o);return`${l.toLocaleString(0)}`}),C=a(""),z=a(),T=a(),H=a(),I=a(),q=a(),P=a(),ee=l=>{z.value=l.entrance,T.value=l.floor,H.value=l.apartment,I.value=l.landmark,q.value=l.name,C.value=l.title,P.value=l.id},te=()=>{z.value=null,T.value=null,H.value=null,I.value="",q.value="",C.value="",P.value=null},W=async()=>{const l=a(`https://yandex.ru/maps/?pt=${oe.value},${R.value}&z=18&l=map`);if(P.value){if((await g(`/user/address/${P.value}/`,{headers:{Authorization:`Bearer ${v.value}`},cache:!1,method:"PUT",body:{entrance:z.value,floor:T.value,apartment:H.value,landmark:I.value,name:q.value,title:C.value,link:l.value}})).status.value==="success"){const{data:p}=await g("/user/address/",{cache:!1,headers:{Authorization:`Bearer ${v.value}`}});w.value=p.value}}else console.log("Что-то пошло не так")},E=async()=>{const l=a(`https://yandex.ru/maps/?pt=${oe.value},${R.value}&z=18&l=map`);if((await g("/user/address/",{cache:!1,headers:{Authorization:`Bearer ${v.value}`},method:"POST",body:{entrance:z.value,floor:T.value,apartment:H.value,landmark:I.value,name:q.value,title:C.value,link:l.value}})).status.value==="success"){const{data:p}=await g("/user/address/",{cache:!1,headers:{Authorization:`Bearer ${v.value}`}});w.value=p.value}},ce=async()=>{setTimeout(async()=>{const{data:l}=await g("/user/address/",{cache:!1,headers:{Authorization:`Bearer ${v.value}`}});w.value=l.value},200);try{const l=await g(`/user/address/${P.value}/`,{cache:!1,method:"DELETE",headers:{Authorization:`Bearer ${v.value}`}})}catch(l){console.error("Произошла ошибка:",l)}},le=a(""),c=l=>{le.value=l},n=async()=>{le.value.children[0]||ne()};let V=!1;const A=a(!1);$e(()=>{b.loadCart(),setTimeout(A.value=!0,500),i().then(()=>{})}),a("");let f=null;function i(){return new Promise(l=>{const o=document.createElement("script");o.src="https://api-maps.yandex.ru/2.1/?apikey=c305ed3e-5b96-4107-95a3-c2f9f3032251&lang=ru_RU",o.onload=l,document.head.appendChild(o)})}const R=a(""),oe=a("");function ne(){V||(V=!0,ymaps.ready(()=>{const l=new ymaps.Map("map2",{center:[41.311153,69.279729],zoom:15}),o=new ymaps.control.SearchControl({options:{noPlacemark:!0,noPopup:!0}});l.controls.remove("searchControl"),l.controls.add(o);function p(O,t=""){const[x,Y]=O;R.value=x,oe.value=Y,f&&l.geoObjects.remove(f),f=new ymaps.Placemark(O,{hintContent:"Местоположение",balloonContent:"Загрузка адреса..."}),l.geoObjects.add(f),t?(C.value=t,f.properties.set({balloonContent:t})):ymaps.geocode(O).then(je=>{const _e=je.geoObjects.get(0);C.value=_e.getAddressLine(),f.properties.set({balloonContent:_e.getAddressLine()})})}o.events.add("resultselect",O=>{const t=O.get("index");o.getResult(t).then(x=>{const Y=x.geometry.getCoordinates();p(Y,x.properties.get("name"))}).catch(x=>{console.log("Ошибка при получении адреса:",x)})}),l.events.add("click",function(O){const t=O.get("coords");p(t)})}))}return fe({title:"Оформление заказа"}),ge({title:"Оформление заказа | OnMalika",ogTitle:"Оформление заказа | OnMalika",ogImage:"https://admin.onmalika.uz/media/images/Logo.original.svg"}),(l,o)=>{const p=ye,O=Ce("maska");return r(),d("main",null,[e("div",ze,[e("nav",Te,[e("ol",Ie,[e("li",Pe,[de(p,{to:"/"},{default:he(()=>[se("Главная")]),_:1})]),Oe])])]),e("section",null,[s(A)?(r(),d("div",De,[s(Z).isAuthenticated?(r(),d("div",Ne,[s(b).items.length>0?(r(),d("div",He,[e("form",{onSubmit:L(N,["prevent"])},[e("div",qe,[e("div",Ee,[Re,e("div",Ze,[e("div",Fe,[u(e("input",{type:"radio",class:"radio-delivery","onUpdate:modelValue":o[0]||(o[0]=t=>h(y)?y.value=t:null),value:"delivery",checked:"",name:"deliveryType",id:"checkDelivery"},null,512),[[ie,s(y)]]),Ge]),e("div",Je,[u(e("input",{type:"radio",class:"radio-delivery","onUpdate:modelValue":o[1]||(o[1]=t=>h(y)?y.value=t:null),value:"self-delivery",name:"deliveryType",id:"checkByself"},null,512),[[ie,s(y)]]),Qe])]),e("div",null,[e("div",We,[Ye,e("div",Ke,[e("div",Xe,[u(e("input",{type:"text",required:"","onUpdate:modelValue":o[2]||(o[2]=t=>h(J)?J.value=t:null),class:"form-control",id:"deliverynameInput",placeholder:"ФИО"},null,512),[[_,s(J)]]),et]),e("div",tt,[u(e("input",{type:"text",required:"","data-maska":"+998 (##) ###-##-##","onUpdate:modelValue":o[3]||(o[3]=t=>h(Q)?Q.value=t:null),class:"form-control",id:"deliverynumberInput",placeholder:""},null,512),[[O],[_,s(Q)]]),ot])])]),s(y)=="delivery"?(r(),d("div",st,[at,s(B)?(r(),d("div",lt," Добавьте адрес! ")):ue("",!0),e("div",nt,[e("ul",null,[(r(!0),d(me,null,pe(s(w),(t,x)=>(r(),d("li",{class:"onmalika-address-inuser",key:t.id},[e("div",it,[e("input",{type:"radio",class:"form-check-input",name:"userChoosenAdresOrder",onClick:Y=>G(t.id),checked:x==0,id:"addChoose"+t.id},null,8,dt),e("label",{class:"form-check-label onmalika-address-item",for:"addChoose"+t.id},[se(k(t.name)+" ",1),e("span",null,k(t.title),1)],8,rt)]),e("div",ct,[e("button",{type:"button","data-bs-toggle":"modal","data-bs-target":"#deleteAddressModal",onClick:Y=>ee(t)},mt,8,ut),e("button",{type:"button","data-bs-toggle":"modal","data-bs-target":"#addressModal",onClick:Y=>ee(t)},[(r(),d("svg",{onClick:n,width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},vt))],8,pt)])]))),128)),e("li",{onClick:n},[e("button",{type:"button",onClick:o[4]||(o[4]=t=>te()),class:"onmalika-address-add","data-bs-toggle":"modal","data-bs-target":"#addressModal"},bt)])])])])):(r(),d("div",ft,yt)),e("div",wt,[$t,e("div",Ct,[e("div",xt,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[5]||(o[5]=t=>h(m)?m.value=t:null),required:"",type:"radio",value:"card",name:"paymentType",id:"deliverypayment1"},null,512),[[ie,s(m)]]),Mt]),e("div",jt,[u(e("input",{class:"form-check-input","onUpdate:modelValue":o[6]||(o[6]=t=>h(m)?m.value=t:null),required:"",type:"radio",value:"cash",name:"paymentType",id:"deliverypayment3"},null,512),[[ie,s(m)]]),At])])]),e("div",Lt,[Vt,u(e("textarea",{"onUpdate:modelValue":o[7]||(o[7]=t=>h(M)?M.value=t:null),placeholder:"Введите"},null,512),[[_,s(M)]])])])]),e("div",St,[Bt,e("div",Ut,[e("ul",null,[(r(!0),d(me,null,pe(s(b).items,t=>(r(),d("li",{key:t.id,class:"card onmalika-card-cart"},[e("button",{class:"remove-product",onClick:x=>s(b).removeFromCart(t.product.id),type:"button"},It,8,zt),de(p,{to:"/shop/"+t.product.category.parent.slug+"/"+t.product.category.slug+"/"+t.product.slug},{default:he(()=>[t&&t.product&&t.product.image&&t.product.image.mini?(r(),d("img",{key:0,src:t.product.image.mini,class:"card-img-top",alt:"...","data-bs-dismiss":"modal"},null,8,Pt)):(r(),d("img",Ot))]),_:2},1032,["to"]),e("div",Dt,[e("h5",Nt,k(t.product.name),1),e("div",Ht,[t.product.sale_price?(r(),d("p",{key:1,class:Ue(["onmalika-card-cart-price",{sale:t.product.sale_price}])},k((t.quantity*j(t.product.sale_price)).toLocaleString())+" "+k(s($).selectedCurrency),3)):(r(),d("p",qt,k((t.quantity*j(t.product.price)).toLocaleString())+" "+k(s($).selectedCurrency),1)),e("div",Et,[e("button",{type:"button",onClick:x=>s(b).decreaseQuantity(t.product.id)},"-",8,Rt),e("span",null,k(t.quantity),1),e("button",{type:"button",onClick:x=>s(b).increaseQuantity(t.product.id)},"+",8,Zt)])])])]))),128))])]),e("div",Ft,[e("div",Gt,[Jt,se(),e("span",null,k(s(ae))+" "+k(s($).selectedCurrency),1)])]),e("button",{class:"dark-cover w-100 justify-content-center check-out-btn",type:"submit",disabled:s(U)},"Оформить заказ",8,Qt)])])],32)])):(r(),d("div",Wt,Kt))])):(r(),d("div",Xt,to))])):(r(),d("div",oo,ao))]),s(Z).isAuthenticated?(r(),d("div",lo,[e("div",no,[e("div",io,[ro,e("div",co,[e("div",uo,[e("div",ho,[e("div",{class:"col-12 mb-3"},[e("div",{class:"map-addres"},[e("div",{ref:c,id:"map2",style:{width:"100%",height:"100%"}})])]),e("div",mo,[e("div",po,[u(e("input",{type:"text",disabled:"",class:"form-control","onUpdate:modelValue":o[8]||(o[8]=t=>h(C)?C.value=t:null),id:"apartment",placeholder:"ФИО"},null,512),[[_,s(C)]]),_o])]),e("div",vo,[e("div",ko,[u(e("input",{type:"text",class:"form-control","onUpdate:modelValue":o[9]||(o[9]=t=>h(z)?z.value=t:null),id:"entrance",placeholder:"ФИО"},null,512),[[_,s(z)]]),bo])]),e("div",fo,[e("div",go,[u(e("input",{type:"text",class:"form-control","onUpdate:modelValue":o[10]||(o[10]=t=>h(T)?T.value=t:null),id:"floor",placeholder:"ФИО"},null,512),[[_,s(T)]]),yo])]),e("div",wo,[e("div",$o,[u(e("input",{type:"text",class:"form-control","onUpdate:modelValue":o[11]||(o[11]=t=>h(H)?H.value=t:null),id:"apartment",placeholder:"ФИО"},null,512),[[_,s(H)]]),Co])]),e("div",xo,[e("div",Mo,[u(e("input",{type:"text",class:"form-control","onUpdate:modelValue":o[12]||(o[12]=t=>h(I)?I.value=t:null),id:"landmark",placeholder:"ФИО"},null,512),[[_,s(I)]]),jo])]),e("div",Ao,[e("div",Lo,[u(e("input",{type:"text",class:"form-control","onUpdate:modelValue":o[13]||(o[13]=t=>h(q)?q.value=t:null),id:"name",placeholder:"ФИО"},null,512),[[_,s(q)]]),Vo])]),e("div",So,[s(P)?(r(),d("form",{key:0,onSubmit:L(W,["prevent"])},Uo,32)):(r(),d("form",{key:1,onSubmit:L(E,["prevent"])},To,32))])])])]),e("div",Io,[s(P)?(r(),d("form",{key:0,onSubmit:L(W,["prevent"])},Oo,32)):(r(),d("form",{key:1,onSubmit:L(E,["prevent"])},[e("button",{type:"submit",class:"dark-cover justify-content-center w-100",disabled:!s(C),"data-bs-dismiss":"modal"}," Добавить адресс",8,Do)],32))])])])])):ue("",!0),s(Z).isAuthenticated?(r(),d("div",No,[e("div",Ho,[e("div",qo,[Eo,e("div",Ro,[Zo,e("p",null,k(s(C)),1),e("form",{onSubmit:L(ce,["prevent"]),class:"modal-btns"},Jo,32)])])])])):ue("",!0)])}}},xa=Object.freeze(Object.defineProperty({__proto__:null,default:Qo},Symbol.toStringTag,{value:"Module"})),Wo={class:"container"},Yo={"aria-label":"breadcrumb"},Ko={class:"breadcrumb onmalika-breadcrumb"},Xo={class:"breadcrumb-item"},es={class:"breadcrumb-item active","aria-current":"page"},ts={class:"container"},os={class:"row justify-content-between"},ss={class:"col-lg-9 col-md-8"},as={class:"row justify-content-between"},ls={class:"col-lg-5 mb-3"},ns={class:"onmalika-user-settings onmalika-user-mobile"},is=e("h5",{class:"mb-3"},"Ваши данные",-1),ds={class:"col-12 info-input"},rs={class:"form-floating"},cs=e("label",{for:"userChangeName"},"ФИО",-1),us={class:"col-12 info-input"},hs={class:"form-floating"},ms=e("label",{for:"userChangeNumber"},"Ваш номер",-1),ps={class:"col-12 info-input"},_s={class:"form-floating"},vs=e("label",{for:"userChangeEmail"},"Ваш email",-1),ks=e("button",{type:"submit",class:"btn w-100 justify-content-center dark-cover"}," Применить изменения ",-1),bs={class:"col-lg-6"},fs={class:"gray-cover onmalika-user-mobile"},gs=e("h5",{class:"mb-3"},"Ваши адреса",-1),ys={class:"onmalika-address"},ws={class:"form-check p-0 m-0"},$s={class:"form-check-label onmalika-address-item",for:"flexRadioDefault1"},Cs={class:"onmalika-address-btns"},xs=["onClick"],Ms=e("img",{src:xe,alt:""},null,-1),js=[Ms],As=["onClick"],Ls=F('<path d="M15.832 18.3334V9.16669" stroke="black" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path><path d="M15.832 5.83335V1.66669" stroke="black" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path><path d="M10 18.3334V14.1667" stroke="black" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path><path d="M10 10.8334V1.66669" stroke="black" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path><path d="M4.16797 18.3334V9.16669" stroke="black" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path><path d="M4.16797 5.83335V1.66669" stroke="black" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path><path d="M2.5 9.16669H5.83333" stroke="black" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path><path d="M14.168 9.16669H17.5013" stroke="black" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path><path d="M8.33203 10.8333H11.6654" stroke="black" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"></path>',9),Vs=[Ls],Ss=F('<div class="form-check p-0 m-0"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.9989 13.43C13.722 13.43 15.1189 12.0331 15.1189 10.31C15.1189 8.58687 13.722 7.19 11.9989 7.19C10.2758 7.19 8.87891 8.58687 8.87891 10.31C8.87891 12.0331 10.2758 13.43 11.9989 13.43Z" stroke="black" stroke-width="1.5"></path><path d="M3.62166 8.49C5.59166 -0.169998 18.4217 -0.159997 20.3817 8.5C21.5317 13.58 18.3717 17.88 15.6017 20.54C13.5917 22.48 10.4117 22.48 8.39166 20.54C5.63166 17.88 2.47166 13.57 3.62166 8.49Z" stroke="black" stroke-width="1.5"></path></svg> Добавить новый адрес </div><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 8H14" stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M8 14V2" stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>',2),Bs=[Ss],Us={class:"modal fade onmalika-address-modal",id:"addressModal",tabindex:"-1","aria-labelledby":"addressModalLabel","aria-hidden":"true"},zs={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},Ts={class:"modal-content"},Is=F('<div class="modal-header"><h4> Адрес доставки</h4><button type="button" class="dark-cover" data-bs-dismiss="modal" aria-label="Close"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.33301 12.6667L12.6663 3.33333" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M12.6663 12.6667L3.33301 3.33333" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div>',1),Ps={class:"modal-body"},Os={class:"gray-cover"},Ds={class:"row"},Ns={class:"col-12 mb-3"},Hs={class:"form-floating w-100"},qs=e("label",{for:"floatingInput"},"Адрес",-1),Es={class:"col-md-4 col-sm-6 mb-3"},Rs={class:"form-floating w-100"},Zs=e("label",{for:"floatingInput"},"Подъезд",-1),Fs={class:"col-md-4 col-sm-6 mb-3"},Gs={class:"form-floating w-100"},Js=e("label",{for:"floatingInput"},"Этаж",-1),Qs={class:"col-md-4 col-sm-6 mb-3"},Ws={class:"form-floating w-100"},Ys=e("label",{for:"floatingInput"},"Квартира",-1),Ks={class:"col-md-4 col-sm-6 mb-3"},Xs={class:"form-floating w-100"},ea=e("label",{for:"floatingInput"},"Ориентир",-1),ta={class:"col-md-4 col-sm-6"},oa={class:"form-floating w-100"},sa=e("label",{for:"floatingInput"},"Название",-1),aa={class:"col-md-4 col-sm-6"},la=e("button",{type:"submit",class:"dark-cover justify-content-center w-100","data-bs-dismiss":"modal"}," Изменить ",-1),na=[la],ia=e("button",{type:"submit",class:"dark-cover justify-content-center w-100","data-bs-dismiss":"modal"}," Добавить адресс",-1),da=[ia],ra={class:"modal-footer"},ca=e("button",{type:"submit",class:"dark-cover justify-content-center w-100","data-bs-dismiss":"modal"}," Изменить",-1),ua=[ca],ha=["disabled"],ma={class:"modal fade onmalika-delete-modal",id:"deleteAddressModal",tabindex:"-1","aria-labelledby":"deleteAddressModalLabel","aria-hidden":"true"},pa={class:"modal-dialog modal-dialog-centered"},_a={class:"modal-content"},va=e("button",{type:"button",class:"clsoe dark-cover","data-bs-dismiss":"modal","aria-label":"Close"},[e("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M3.33301 12.6667L12.6663 3.33333",stroke:"white","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),e("path",{d:"M12.6663 12.6667L3.33301 3.33333",stroke:"white","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})])],-1),ka={class:"modal-body"},ba=e("h4",null,"Удалить адрес?",-1),fa=e("button",{type:"submit",class:"dark-cover","data-bs-dismiss":"modal"},"Да",-1),ga=e("button",{type:"button",class:"light-cover","data-bs-dismiss":"modal"},"Нет",-1),ya=[fa,ga],wa={__name:"index",async setup(Me){let D,K;const Z=a("Главная"),X=a("Профиль"),b=ke(),v=be("token_access"),w=a(b.user.first_name),re=a(b.user.last_name),S=a(b.user.phone_number),G=a(b.user.email),y=a([]),{data:J}=([D,K]=we(()=>g("/user/address/",{cache:!1,headers:{Authorization:`Bearer ${v.value}`}})),D=await D,K(),D);y.value=J.value;const Q=async()=>{await g("/user/",{cache:!1,method:"PUT",headers:{Authorization:`Bearer ${v.value}`},body:{id:b.user.id,username:b.user.username,first_name:w.value,last_name:re.value,phone_number:S.value,email:G.value}})},m=a(""),M=a(),B=a(),U=a(),N=a(),$=a(),j=a(),ae=c=>{M.value=c.entrance,B.value=c.floor,U.value=c.apartment,N.value=c.landmark,$.value=c.name,m.value=c.title,j.value=c.id},C=()=>{M.value=null,B.value=null,U.value=null,N.value="",$.value="",m.value="",j.value=null},z=async()=>{const c=a(`https://yandex.ru/maps/?pt=${W.value},${te.value}&z=18&l=map`);if(j.value){if((await g(`/user/address/${j.value}/`,{headers:{Authorization:`Bearer ${v.value}`},cache:!1,method:"PUT",body:{entrance:M.value,floor:B.value,apartment:U.value,landmark:N.value,name:$.value,title:m.value,link:c.value}})).status.value==="success"){const{data:V}=await g("/user/address/",{cache:!1,headers:{Authorization:`Bearer ${v.value}`}});y.value=V.value}}else console.log("Что-то пошло не так")},T=async()=>{const c=a(`https://yandex.ru/maps/?pt=${W.value},${te.value}&z=18&l=map`);if(m.value)try{if((await g("/user/address/",{cache:!1,headers:{Authorization:`Bearer ${v.value}`},method:"POST",body:{entrance:M.value,floor:B.value,apartment:U.value,landmark:N.value,name:$.value,title:m.value,link:c.value}})).status.value==="success"){const{data:V}=await g("/user/address/",{cache:!1,headers:{Authorization:`Bearer ${v.value}`}});y.value=V.value}}catch(n){console.error("Произошла ошибка:",n)}},H=async()=>{setTimeout(async()=>{const{data:c}=await g("/user/address/",{cache:!1,headers:{Authorization:`Bearer ${v.value}`}});y.value=c.value},200);try{const c=await g(`/user/address/${j.value}/`,{cache:!1,method:"DELETE",headers:{Authorization:`Bearer ${v.value}`}})}catch(c){console.error("Произошла ошибка:",c)}},I=a(""),q=c=>{I.value=c};$e(()=>{ce().then(()=>{})});let P=!1;const ee=async()=>{I.value.children[0]||le()},te=a(""),W=a("");let E=null;function ce(){return new Promise(c=>{const n=document.createElement("script");n.src="https://api-maps.yandex.ru/2.1/?apikey=c305ed3e-5b96-4107-95a3-c2f9f3032251&lang=ru_RU",n.onload=c,document.head.appendChild(n)})}function le(){P||(P=!0,ymaps.ready(()=>{const c=new ymaps.Map("map",{center:[41.311153,69.279729],zoom:15}),n=new ymaps.control.SearchControl({options:{noPlacemark:!0,noPopup:!0}});c.controls.remove("searchControl"),c.controls.add(n);function V(A,f=""){const[i,R]=A;te.value=i,W.value=R,E&&c.geoObjects.remove(E),E=new ymaps.Placemark(A,{hintContent:"Местоположение",balloonContent:"Загрузка адреса..."}),c.geoObjects.add(E),f?(m.value=f,E.properties.set({balloonContent:f})):ymaps.geocode(A).then(oe=>{const ne=oe.geoObjects.get(0);m.value=ne.getAddressLine(),E.properties.set({balloonContent:ne.getAddressLine()})})}n.events.add("resultselect",A=>{const f=A.get("index");n.getResult(f).then(i=>{const R=i.geometry.getCoordinates();V(R,i.properties.get("name"))}).catch(i=>{console.log("Ошибка при получении адреса:",i)})}),c.events.add("click",function(A){const f=A.get("coords");V(f)})}))}return fe({title:"Профиль"}),ge({title:"Профиль | OnMalika",ogTitle:"Профиль | OnMalika"}),(c,n)=>{const V=ye,A=Be,f=Ce("maska");return r(),d("main",null,[e("div",Wo,[e("nav",Yo,[e("ol",Ko,[e("li",Xo,[de(V,{to:"/"},{default:he(()=>[se(k(s(Z)),1)]),_:1})]),e("li",es,k(s(X)),1)])])]),e("section",null,[e("div",ts,[e("h1",null,k(s(X)),1),e("div",os,[de(A),e("div",ss,[e("div",as,[e("div",ls,[e("div",ns,[e("form",{onSubmit:L(Q,["prevent"])},[is,e("div",ds,[e("div",rs,[u(e("input",{"onUpdate:modelValue":n[0]||(n[0]=i=>h(w)?w.value=i:null),type:"text",class:"form-control",id:"userChangeName",placeholder:"ФИО"},null,512),[[_,s(w)]]),cs])]),e("div",us,[e("div",hs,[u(e("input",{"onUpdate:modelValue":n[1]||(n[1]=i=>h(S)?S.value=i:null),"data-maska":"+998 (##) ###-##-##",type:"text",class:"form-control",id:"userChangeNumber",placeholder:"ФИО"},null,512),[[_,s(S)],[f]]),ms])]),e("div",ps,[e("div",_s,[u(e("input",{"onUpdate:modelValue":n[2]||(n[2]=i=>h(G)?G.value=i:null),type:"email",class:"form-control",id:"userChangeEmail",placeholder:"ФИО"},null,512),[[_,s(G)]]),vs])]),ks],32)])]),e("div",bs,[e("div",fs,[gs,e("div",ys,[e("ul",null,[(r(!0),d(me,null,pe(s(y),i=>(r(),d("li",{class:"onmalika-address-inuser",key:i.id},[e("div",ws,[e("label",$s,[se(k(i.name)+" ",1),e("span",null,k(i.title),1)])]),e("div",Cs,[e("button",{type:"button","data-bs-toggle":"modal","data-bs-target":"#deleteAddressModal",onClick:R=>ae(i)},js,8,xs),e("button",{type:"button","data-bs-toggle":"modal","data-bs-target":"#addressModal",onClick:R=>ae(i)},[(r(),d("svg",{onClick:ee,width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Vs))],8,As)])]))),128)),e("li",{onClick:ee},[e("button",{type:"button",onClick:n[3]||(n[3]=i=>C()),class:"onmalika-address-add","data-bs-toggle":"modal","data-bs-target":"#addressModal"},Bs)])])])])])])])])])]),e("div",Us,[e("div",zs,[e("div",Ts,[Is,e("div",Ps,[e("div",Os,[e("div",Ds,[e("div",{class:"col-12 mb-3"},[e("div",{class:"map-addres"},[e("div",{ref:q,id:"map",style:{width:"100%",height:"100%"}})])]),e("div",Ns,[e("div",Hs,[u(e("input",{type:"text",disabled:"",class:"form-control","onUpdate:modelValue":n[4]||(n[4]=i=>h(m)?m.value=i:null),id:"apartment",placeholder:"ФИО"},null,512),[[_,s(m)]]),qs])]),e("div",Es,[e("div",Rs,[u(e("input",{type:"text",class:"form-control","onUpdate:modelValue":n[5]||(n[5]=i=>h(M)?M.value=i:null),id:"entrance",placeholder:"ФИО"},null,512),[[_,s(M)]]),Zs])]),e("div",Fs,[e("div",Gs,[u(e("input",{type:"text",class:"form-control","onUpdate:modelValue":n[6]||(n[6]=i=>h(B)?B.value=i:null),id:"floor",placeholder:"ФИО"},null,512),[[_,s(B)]]),Js])]),e("div",Qs,[e("div",Ws,[u(e("input",{type:"text",class:"form-control","onUpdate:modelValue":n[7]||(n[7]=i=>h(U)?U.value=i:null),id:"apartment",placeholder:"ФИО"},null,512),[[_,s(U)]]),Ys])]),e("div",Ks,[e("div",Xs,[u(e("input",{type:"text",class:"form-control","onUpdate:modelValue":n[8]||(n[8]=i=>h(N)?N.value=i:null),id:"landmark",placeholder:"ФИО"},null,512),[[_,s(N)]]),ea])]),e("div",ta,[e("div",oa,[u(e("input",{type:"text",class:"form-control","onUpdate:modelValue":n[9]||(n[9]=i=>h($)?$.value=i:null),id:"name",placeholder:"ФИО"},null,512),[[_,s($)]]),sa])]),e("div",aa,[s(j)?(r(),d("form",{key:0,onSubmit:L(z,["prevent"])},na,32)):(r(),d("form",{key:1,onSubmit:L(T,["prevent"])},da,32))])])])]),e("div",ra,[s(j)?(r(),d("form",{key:0,onSubmit:L(z,["prevent"])},ua,32)):(r(),d("form",{key:1,onSubmit:L(T,["prevent"])},[e("button",{type:"submit",class:"dark-cover justify-content-center w-100",disabled:!s(m),"data-bs-dismiss":"modal"}," Добавить адресс",8,ha)],32))])])])]),e("div",ma,[e("div",pa,[e("div",_a,[va,e("div",ka,[ba,e("p",null,k(s(m)),1),e("form",{onSubmit:L(H,["prevent"]),class:"modal-btns"},ya,32)])])])])])}}},Ma=Object.freeze(Object.defineProperty({__proto__:null,default:wa},Symbol.toStringTag,{value:"Module"}));export{xa as c,Ma as i};
