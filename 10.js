import{p as U,g as Y,f as ee,h as te,o as se,b as V,d as P,c as H,s as Q,j as oe,e as ae,u as ie}from"./DIDzDSBz.js";import{_ as ne,a as re,b as le}from"./Bzjm-jEg.js";import{a as m,x as F,w as ce,o,c as a,g as t,u as e,i as g,t as f,e as z,h as C,q,n as I,l as Z,p as de,k as ue,G as he,C as _e,H as pe,I as me,F as D,d as W}from"./DoqiT5Lj.js";const E=U("/img/250x250.svg"),G=U("/svg/fav.svg"),ke={class:"card onmalika-card h-100"},ve={class:"onmalika-card-badges"},ge={key:0,class:"badge onmalika-card-badges-new",style:{"background-color":"#80ee98",color:"#000"}},fe={key:1,class:"badge onmalika-card-badges-new",style:{"background-color":"#ff4a4a",color:"#fff"}},ye=t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M12.62 20.81C12.28 20.93 11.72 20.93 11.38 20.81C8.48 19.82 2 15.69 2 8.68998C2 5.59998 4.49 3.09998 7.56 3.09998C9.38 3.09998 10.99 3.97998 12 5.33998C13.01 3.97998 14.63 3.09998 16.44 3.09998C19.51 3.09998 22 5.59998 22 8.68998C22 15.69 15.52 19.82 12.62 20.81Z",stroke:"black","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1),be=[ye],we={key:1,class:"onmalika-card-favorite","data-bs-toggle":"modal","data-bs-target":"#authModal"},$e=t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M12.62 20.81C12.28 20.93 11.72 20.93 11.38 20.81C8.48 19.82 2 15.69 2 8.68998C2 5.59998 4.49 3.09998 7.56 3.09998C9.38 3.09998 10.99 3.97998 12 5.33998C13.01 3.97998 14.63 3.09998 16.44 3.09998C19.51 3.09998 22 5.59998 22 8.68998C22 15.69 15.52 19.82 12.62 20.81Z",stroke:"black","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1),Ce=[$e],xe=["src","alt"],Se={key:1,src:E,alt:"","data-bs-dismiss":"modal"},Me=["src","alt"],Te={key:1,src:E,alt:""},je={class:"card-body onmalika-card-body"},Pe={class:"onmalika-card-title","data-bs-dismiss":"modal"},qe={key:0,class:"onmalika-card-stock"},Ie=t("img",{src:ne,width:"24",height:"24",alt:"Есть в наличии"},null,-1),Be=t("p",null,"Есть в наличии",-1),Le=[Ie,Be],Ne={key:1,class:"onmalika-card-stock"},Oe=t("img",{src:re,width:"24",height:"24",alt:"Нет в наличии"},null,-1),ze=t("p",null,"Нет в наличии",-1),Fe=[Oe,ze],Re={key:2,class:"onmalika-card-stock"},Ae=t("img",{src:le,width:"24",height:"24",alt:"Скоро"},null,-1),De=t("p",null,"Скоро",-1),We=[Ae,De],Ue={key:0,class:"onmalika-card-price"},Ve={key:4,class:"onmalika-card-body-orderbtn"},He={key:1,class:"product-counter"},Qe={key:2,class:"onmalika-card-body-orderbtn-rating"},Ze=t("img",{src:G,width:"24",height:"24",alt:"favorite"},null,-1),Ee={key:5,class:"onmalika-card-body-orderbtn"},Ge={class:"onmalika-card-body-orderbtn-rating"},Je=t("img",{src:G,width:"24",height:"24",alt:"favorite"},null,-1),J={__name:"Card",props:{product_info:{type:Object,required:!0},from_modal:{type:Boolean,required:!1}},setup(N){const d=Y(),k=ee(),_=N,{product_info:s}=_,O=te("token_access"),S=m(1),n=F(()=>{if(s&&s.price&&s.sale_price)return 100-(s.sale_price*100/s.price).toFixed(0)}),B=async u=>{d.isAuthenticated&&(await V("/user/favorites/",{method:"POST",headers:{Authorization:`Bearer ${O.value}`},body:{user:d.user.id,product_id:s.id}}),P().add(u),P().addedInCard=!1,P().addedInFav=!0)},p=u=>{k.isProductInCart(u.id)||(S.value=1),k.addToCart(u,S.value),P().add(u),P().addedInCard=!0,P().addedInFav=!1};ce(()=>k.items,u=>{const r=u.find(h=>h.product.id===s.id);r&&(S.value=r.quantity)},{deep:!0});const y=se(),w=u=>{const r=y.currencies.find(b=>b.code===y.selectedCurrency);if(!r)return"Цена не доступна";const h=parseFloat(r.exchange_rate);return`${(u*h).toLocaleString()} ${r.symbol}`},M=m(!1);return(()=>{const u=new Date,r=new Date(s.first_published_at),h=u.getTime()-r.getTime(),T=7*24*60*60*1e3;h<=T&&h>=0?M.value=!0:M.value=!1})(),(u,r)=>{const h=H,T=Q;return o(),a("div",ke,[t("div",ve,[e(M)?(o(),a("span",ge,"new")):g("",!0),e(n)?(o(),a("span",fe,f(e(n))+"%",1)):g("",!0)]),e(d).isAuthenticated?(o(),a("button",{key:0,class:"onmalika-card-favorite",onClick:r[0]||(r[0]=j=>B(e(s)))},be)):(o(),a("button",we,Ce)),N.from_modal?(o(),z(h,{key:2,to:"/shop/"+e(s).category.parent.slug+"/"+e(s).category.slug+"/"+e(s).slug+"/",class:"product-link"},{default:C(()=>[e(s)&&e(s).image&&e(s).image.card?(o(),a("img",{key:0,src:e(s).image.card,class:"card-img-top",alt:e(s).name,loading:"lazy",width:"300",height:"300","data-bs-dismiss":"modal"},null,8,xe)):(o(),a("img",Se))]),_:1},8,["to"])):(o(),z(h,{key:3,to:"/shop/"+e(s).category.parent.slug+"/"+e(s).category.slug+"/"+e(s).slug+"/",class:"product-link"},{default:C(()=>[e(s)&&e(s).image&&e(s).image.card?(o(),a("img",{key:0,src:e(s).image.card,class:"card-img-top",alt:e(s).name,loading:"lazy",width:"300",height:"300"},null,8,Me)):(o(),a("img",Te))]),_:1},8,["to"])),t("div",je,[q(h,{class:"p-0",to:"/shop/"+e(s).category.parent.slug+"/"+e(s).category.slug+"/"+e(s).slug+"/"},{default:C(()=>[t("h5",Pe,f(e(s).name),1)]),_:1},8,["to"]),e(s).availability=="InStock"?(o(),a("div",qe,Le)):g("",!0),e(s).availability=="OutOfStock"?(o(),a("div",Ne,Fe)):g("",!0),e(s).availability=="Soon"?(o(),a("div",Re,We)):g("",!0),e(s).availability=="InStock"?(o(),z(T,{key:3},{default:C(()=>[e(y).selectedCurrency?(o(),a("div",Ue,[e(s).sale_price?(o(),a("span",{key:0,class:I({active:e(s).sale_price})},f(w(e(s).sale_price)),3)):g("",!0),t("p",{class:I({active:e(s).sale_price})},f(w(e(s).price)),3)])):g("",!0)]),_:1})):g("",!0),e(s).availability=="InStock"?(o(),a("div",Ve,[e(k).isProductInCart(e(s).id)?(o(),a("div",He,[t("button",{type:"button",onClick:r[2]||(r[2]=j=>e(k).decreaseQuantity(e(s).id))}," - "),t("span",null,f(e(S)),1),t("button",{type:"button",onClick:r[3]||(r[3]=j=>e(k).increaseQuantity(e(s).id))}," + ")])):(o(),a("button",{key:0,onClick:r[1]||(r[1]=j=>p(e(s))),type:"button",class:"btn dark-cover justify-content-center"}," В корзину ")),e(s)&&e(s).product_rate?(o(),a("div",Qe,[Ze,t("p",null,f(e(s).product_rate),1)])):g("",!0)])):(o(),a("div",Ee,[q(h,{to:"/shop/"+e(s).category.parent.slug+"/"+e(s).category.slug+"/"+e(s).slug+"/",class:"btn dark-cover justify-content-center"},{default:C(()=>[Z(" Подробнее ")]),_:1},8,["to"]),t("div",Ge,[Je,t("p",null,f(e(s).product_rate),1)])]))])])}}},It=Object.freeze(Object.defineProperty({__proto__:null,default:J},Symbol.toStringTag,{value:"Module"})),Ke={class:"container"},Xe={"aria-label":"breadcrumb"},Ye={class:"breadcrumb onmalika-breadcrumb"},et={class:"breadcrumb-item"},tt={key:0,class:"breadcrumb-item active","aria-current":"page"},st={key:1,class:"breadcrumb-item active","aria-current":"page"},ot={class:"container"},at={key:0},it={key:1},nt={class:"onmalika-search-modal"},rt={class:"modal-search-input"},lt={class:"input-group"},ct=t("span",{class:"input-group-text",id:"basic-addon1"},[t("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M11.5 21C16.7467 21 21 16.7467 21 11.5C21 6.25329 16.7467 2 11.5 2C6.25329 2 2 6.25329 2 11.5C2 16.7467 6.25329 21 11.5 21Z",stroke:"black","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M22 22L20 20",stroke:"black","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})])],-1),dt=t("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M3.33301 12.6667L12.6663 3.33333",stroke:"white","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M12.6663 12.6667L3.33301 3.33333",stroke:"white","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1),ut=[dt],ht=t("button",{type:"submit","data-bs-dismiss":"modal",class:"btn dark-cover"}," Поиск ",-1),_t={class:"row row-cols-lg-4 row-cols-md-3 row-cols-sm-2 row-cols-1 onmalika-card-margin mb-50"},pt={key:0,"aria-label":"Page navigation example"},mt={class:"pagination onmalika-pagination justify-content-start"},kt={class:"page-item"},vt=["disabled"],gt=t("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M7.9763 4.94165L2.91797 9.99998L7.9763 15.0583",stroke:"white","stroke-width":"1.5","stroke-miterlimit":"10","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M17.0836 10H3.05859",stroke:"white","stroke-width":"1.5","stroke-miterlimit":"10","stroke-linecap":"round","stroke-linejoin":"round"})],-1),ft=[gt],yt={key:0},bt=t("span",{class:"onmalika-pagination-more"},"...",-1),wt=[bt],$t=["onClick"],Ct={class:"page-item"},xt=["disabled"],St=t("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M12.0234 4.94165L17.0818 9.99998L12.0234 15.0583",stroke:"white","stroke-width":"1.5","stroke-miterlimit":"10","stroke-linecap":"round","stroke-linejoin":"round"}),t("path",{d:"M2.91797 10H16.943",stroke:"white","stroke-width":"1.5","stroke-miterlimit":"10","stroke-linecap":"round","stroke-linejoin":"round"})],-1),Mt=[St],Tt={__name:"search",setup(N){const d=oe(),k=ae(),_=m(d.query.search),s=m([]),O=m(null),S=m(null),n=m(1);n.value=Number(d.query.page)||1;const B=m(0),p=m(12),y=F(()=>Math.ceil(B.value/p.value));console.log(_);const w=async i=>{try{const l=await V(i,{cache:!1});if(l&&l.data&&l.data.value){const v=l.data.value;s.value=v,O.value=v.next,S.value=v.previous,B.value=v.count}else console.error("Ответ от сервера пустой или не соответствует ожидаемому формату",l)}catch(l){console.error("Ошибка при получении данных: ",l)}},M=(n.value-1)*p.value;w(`/products/?search=${_.value}&limit=${p.value}&offset=${M}`);const R=async i=>{window.scrollTo(0,0),n.value=i;const l=(i-1)*p.value;let v=`/products/?search=${_.value}&limit=${p.value}&offset=${l}`;await w(v),await k.push({path:d.path,query:{...d.query,page:i}})},u=async()=>{window.scrollTo(0,0);const i=n.value+1;if(i<=y.value){n.value=i;let l=`/products/?search=${_.value}&limit=${p.value}&offset=${(i-1)*p.value}`;w(l)}await k.push({path:d.path,query:{...d.query,page:i}})},r=async()=>{window.scrollTo(0,0);const i=n.value-1;if(i>=1){n.value=i;let l=`/products/?search=${_.value}&limit=${p.value}&offset=${(i-1)*p.value}`;w(l),await k.push({path:d.path,query:{...d.query,page:i}})}},h=m(!1),T=F(()=>j(y.value,n.value,2));function j(i,l,v){let x=l-v,$=l+v;const c=[];h.value==!1&&(x>1&&c.push(1),x>2&&c.push("...")),x=Math.max(x,1),$=Math.min($,i);for(let L=x;L<=$;L++)c.push(L);return h.value==!1&&($<i-1&&c.push("..."),$<i&&c.push(i)),c}de(()=>{window.innerWidth<=575&&(h.value=!0);const i=parseInt(d.query.page,10);n.value=!isNaN(i)&&i>0?i:1,(n.value-1)*p.value}),ue(()=>{d.query.search!==_.value&&(_.value=d.query.search,n.value=Number(d.query.page)||1,w(`/products/?search=${_.value}&limit=${p.value}&offset=${M}`))});const b=m(""),A=m([]),K=async()=>{b.value.trim()===""?alert("Введите что нибудь"):(await k.push(`/search?search=${b.value}`),A.value=[])},X=()=>{b.value="",A.value=[]};return ie({title:"Поиск | OnMalika",ogTitle:"Поиск | OnMalika"}),(i,l)=>{const v=H,x=J,$=Q;return o(),a("main",null,[t("div",Ke,[t("nav",Xe,[t("ol",Ye,[t("li",et,[q(v,{to:"/"},{default:C(()=>[Z("Главная")]),_:1})]),e(_)?(o(),a("li",tt," Результаты поиска: "+f(e(_)),1)):(o(),a("li",st," Поиск "))])])]),t("section",null,[t("div",ot,[e(_)?(o(),a("h1",at,"Результаты поиска : "+f(e(_)),1)):(o(),a("h1",it,"Поиск")),t("div",nt,[t("div",rt,[t("form",{ref:"searchWrapper",class:"w-100",onSubmit:he(K,["prevent"])},[t("div",lt,[ct,_e(t("input",{autocomplete:"off",type:"text",class:"form-control",placeholder:"Найдите свой товар!","onUpdate:modelValue":l[0]||(l[0]=c=>me(b)?b.value=c:null),id:"search","aria-describedby":"search"},null,512),[[pe,e(b)]]),e(b)?(o(),a("button",{key:0,onClick:X,type:"button",class:"input-clear-btn"},ut)):g("",!0)]),ht],544)])]),t("div",_t,[q($,null,{default:C(()=>[(o(!0),a(D,null,W(e(s).results,c=>(o(),a("div",{class:"col",key:c.id},[q(x,{product_info:c},null,8,["product_info"])]))),128))]),_:1})]),q($,null,{default:C(()=>[e(y)>1?(o(),a("nav",pt,[t("ul",mt,[t("li",kt,[t("button",{type:"button",class:I(["dark-cover",{disabled:e(n)===1}]),onClick:r,disabled:e(n)===1},ft,10,vt)]),(o(!0),a(D,null,W(e(T),c=>(o(),a("li",{class:"page-item",key:c},[c==="..."?(o(),a("div",yt,wt)):(o(),a("button",{key:1,type:"button",class:I(["onmalika-pagination-links",{active:c===e(n)}]),onClick:L=>R(c)},f(c),11,$t))]))),128)),t("li",Ct,[t("button",{type:"button",class:I(["dark-cover",{disabled:e(n)===e(y)}]),onClick:u,disabled:e(n)===e(y)},Mt,10,xt)])])])):g("",!0)]),_:1})])])])}}},Bt=Object.freeze(Object.defineProperty({__proto__:null,default:Tt},Symbol.toStringTag,{value:"Module"}));export{It as C,Bt as s};
